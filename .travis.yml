language: node_js
node_js:
    - lts/*

script:
    - yarn build

deploy:
    - provider: script
      skip_cleanup: true
      script:
          - npx --package @dhis2/deploy-build deploy-build
      on:
          tags: false
          all_branches: true

    - provider: script
      skip_cleanup: true
      script:
          - npx @dhis2/cli-utils release --publish npm
      on:
          tags: false
          branch: master

env:
    global:
        - GIT_AUTHOR_NAME=@dhis2-bot
        - GIT_AUTHOR_EMAIL=ci@dhis2.org
        - GIT_COMMITTER_NAME=@dhis2-bot
        - GIT_COMMITTER_EMAIL=ci@dhis2.org
